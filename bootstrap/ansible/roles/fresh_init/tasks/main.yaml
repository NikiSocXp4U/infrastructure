- name: Change hostname
  ansible.builtin.hostname:
    name: "{{short_hostname}}"

- name: Alter /etc/hosts with new hostname
  ansible.builtin.template:
    src: hosts.j2
    dest: /etc/hosts
    mode: "644"

- name: Create Ansible user
  ansible.builtin.user:
    name: ansible
    comment: Ansible
    state: present
    append: yes
    create_home: yes
    groups: wheel

- name: Set authorized key for Ansible
  ansible.posix.authorized_key:
    user: ansible
    state: present
    key: "{{ssh_public_key}}"

- name: Set static IP
  community.general.nmcli:
    conn_name: "{{ interface }}"
    type: ethernet
    ifname: "{{ interface }}"
    method4: manual
    ip4: "{{ ip }}/{{ cidr }}"
    gw4: "{{ gateway }}"
    dns4:
      - 8.8.8.8
      - 8.8.4.4
    state: present
